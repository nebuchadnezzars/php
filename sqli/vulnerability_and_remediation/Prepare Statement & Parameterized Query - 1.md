# PHP - Prepare Statement & Parameterized Query - 1

SQLi;  kullanıcı tarafından kontrol edilen verilerin doğrudan SQL sorgularına eklenmesi nedeniyle ortaya çıkar.

```sql
<?php
// Veritabanı bağlantısı
$servername = "localhost";
$username = "root";
$password = "";
$dbname = "simple_web_app";

try {
            $conn = new PDO("mysql:host=$servername;dbname=$dbname", $username, $password);

            // PDO hata modunu ayarla
            $conn->setAttribute(PDO::ATTR_ERRMODE, PDO::ERRMODE_EXCEPTION);

            $username = $_GET['username'];

            // Parametrized statement
            $stmt = $conn->prepare("SELECT id, password FROM users WHERE username = :username");

// ? => place holder
// : => place holder

            $stmt->bindParam(':username', $username);

            $stmt->debugDumpParams();

            echo "</br></br>";

            $stmt->execute();

            echo "</br></br>";

            $stmt->debugDumpParams();

            echo "</br></br>";

            $result = $stmt->fetch(PDO::FETCH_ASSOC);

            if ($result)
            {
                echo "Kullanıcı ID: " . $result['id'] . "<br>";
                echo "Kullanıcı Parolası: " . $result['password'];
            }

            else
            {
                echo "Kullanıcı bulunamadı.";
            }
}

catch (PDOException $e)
{
    echo "Hata: " . $e->getMessage();
}

// Veritabanı bağlantısını kapat
$conn = null;
?>
```

- http://localhost:7008/sql_parametrized.php?username=aaaaaaa

SQL: [57] SELECT id, password FROM users WHERE username = :username Params: 1 Key: Name: [9] :username paramno=-1 name=[9] ":username" is_param=1 param_type=2

SQL: [57] SELECT id, password FROM users WHERE username = :username Sent SQL: [54] SELECT id, password FROM users WHERE username = 'aaaa' Params: 1 Key: Name: [9] :username paramno=-1 name=[9] ":username" is_param=1 param_type=2

Kullanıcı bulunamadı.

- http://localhost:7008/sql_parametrized.php?username=test

SQL: [57] SELECT id, password FROM users WHERE username = :username Params: 1 Key: Name: [9] :username paramno=-1 name=[9] ":username" is_param=1 param_type=2

SQL: [57] SELECT id, password FROM users WHERE username = :username Sent SQL: [54] SELECT id, password FROM users WHERE username = 'test' Params: 1 Key: Name: [9] :username paramno=-1 name=[9] ":username" is_param=1 param_type=2

Kullanıcı ID: 1
Kullanıcı Parolası: $2y$10$xsHCrE1k14UBwkmqmChMAuFkJ/8gp3bFrLgz.fUlmLYuCQQojQwYi

**Otomatik Escape:** Parametrized sorgular, veritabanına  gönderilmeden önce **otomatik olarak verileri escape eder**. 

Bu, özel karakterlerin (örneğin, tek tırnaklar) normal veri olarak işlenmesini engeller. 

Kullanıcı girişi içeren sorgulardaki özel karakterler, gerçek anlamıyla değil, metin içindeki özel karakter olarak ele alınır. 

Aşağıdaki örnekleri inceleyelim;

tek tırnak - single quote

- http://localhost:7008/sql_parametrized.php?username=aaaaaaa'+or+1=1--+-

SQL: [57] SELECT id, password FROM users WHERE username = :username Params: 1 Key: Name: [9] :username paramno=-1 name=[9] ":username" is_param=1 param_type=2

SQL: [57] SELECT id, password FROM users WHERE username = :username Sent SQL: [70] SELECT id, password FROM users WHERE username = 'aaaaaaa\' or 1=1-- -' Params: 1 Key: Name: [9] :username paramno=-1 name=[9] ":username" is_param=1 param_type=2

Kullanıcı bulunamadı.

çift tırnak - double quote

- http://localhost:7008/sql_parametrized.php?username=aaaaaaa"+or+1=1--+-

SQL: [57] SELECT id, password FROM users WHERE username = :username Params: 1 Key: Name: [9] :username paramno=-1 name=[9] ":username" is_param=1 param_type=2

SQL: [57] SELECT id, password FROM users WHERE username = :username Sent SQL: [70] SELECT id, password FROM users WHERE username = 'aaaaaaa\" or 1=1-- -' Params: 1 Key: Name: [9] :username paramno=-1 name=[9] ":username" is_param=1 param_type=2

Kullanıcı bulunamadı.
